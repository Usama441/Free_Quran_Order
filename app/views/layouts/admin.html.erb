<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= content_for?(:title) ? yield(:title) : "Admin Dashboard - Quran Orders" %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <%= stylesheet_link_tag "admin_layout", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "themes/theme_green", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "themes/theme_sky", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "themes/theme_black", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "themes/theme_purple", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "admin_layout", "data-turbo-track": "reload" %>
</head>

<body class="bg-gray-50 text-gray-800 flex flex-col h-screen">
  <!-- Immediate theme loading to prevent flicker -->
  <script>
    (function() {
      // Load saved theme immediately to prevent flicker
      const savedTheme = localStorage.getItem('adminTheme') || 'green';
      if (savedTheme !== 'green') {
        document.body.classList.add(`theme-${savedTheme}`);
      }

      // Load user's sidebar state
      const sidebarHidden = localStorage.getItem('adminSidebarHidden') === 'true';
      if (sidebarHidden) {
        document.body.classList.add('sidebar-hidden');
      }

      // Load user's sidebar mode
      const sidebarMode = localStorage.getItem('sidebarMode');
      if (sidebarMode && sidebarMode !== 'normal') {
        const sidebarEl = document.querySelector('body aside');
        if (sidebarEl) {
          if (sidebarMode === 'locked') {
            sidebarEl.classList.add('sidebar-locked');
          } else if (sidebarMode === 'scrolled') {
            sidebarEl.classList.add('sidebar-scrolled');
          }
        }
      }
    })();
  </script>

  <div class="flex flex-1 min-h-0">
    <!-- Sidebar -->
     <aside class="w-64 bg-green-700 text-white flex flex-col">
    
    <!-- User Info Section at Top -->
    <div class="px-4 py-3 border-b border-green-600">
      <div class="flex items-center justify-between">
        <!-- User Avatar -->
        <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center mr-3">
          <i class="fas fa-user text-white text-sm"></i>
        </div>

        <!-- User Info -->
        <div class="flex-1 min-w-0">
          <% if current_admin %>
            <p class="text-sm font-medium text-white truncate">
              <%= current_admin.first_name %> <%= current_admin.last_name %>
            </p>
            <p class="text-xs text-green-300 truncate capitalize">
              <%= current_admin.role.humanize %>
            </p>
          <% else %>
            <p class="text-sm font-medium text-white truncate">
              Guest User
            </p>
            <p class="text-xs text-green-300 truncate">
              Please Sign In
            </p>
          <% end %>
        </div>

        <!-- Logout Button -->
        <%= button_to destroy_admin_session_path, method: :delete,
            class: "text-green-300 hover:text-white transition-colors duration-200" do %>
          <i class="fas fa-sign-out-alt"></i>
        <% end %>
      </div>
    </div>

    <nav class="flex-1 p-4 space-y-3">
      <%= link_to admin_dashboard_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
        <i class="fas fa-chart-line"></i><span>Dashboard</span>
      <% end %>
      <%= link_to admin_qurans_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
        <i class="fas fa-book-quran"></i><span>Quran Management</span>
      <% end %>
      <%= link_to admin_orders_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
        <i class="fas fa-shopping-cart"></i><span>Order Management</span>
      <% end %>
      <div class="pt-4">
        <p class="text-xs text-green-300 uppercase font-semibold mb-2">User Management</p>
        <% if current_admin && current_admin.super_admin? %>
          <%= link_to admin_admins_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
            <i class="fas fa-users-cog"></i><span>Admin Users</span>
          <% end %>
        <% end %>
      </div>
      <div class="pt-2">
        <p class="text-xs text-green-300 uppercase font-semibold mb-2">Analytics</p>
        <%= link_to admin_order_analytics_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
          <i class="fas fa-shopping-cart"></i><span>Order Analytics</span>
        <% end %>
        <%= link_to admin_customer_analytics_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
          <i class="fas fa-users"></i><span>Customer Insights</span>
        <% end %>
        <%= link_to admin_reports_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
          <i class="fas fa-chart-bar"></i><span>Reports</span>
        <% end %>
      </div>
      <div class="pt-2">
        <p class="text-xs text-green-300 uppercase font-semibold mb-2">Settings</p>
        <%= link_to admin_configuration_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
          <i class="fas fa-cog"></i><span>Configuration</span>
        <% end %>
        <%= link_to admin_notifications_path, class: "flex items-center space-x-2 p-3 rounded-lg hover:bg-green-600 transition" do %>
          <i class="fas fa-envelope"></i><span>Notifications</span>
        <% end %>
      </div>
    </nav>

  </aside>
    <!-- Main Content Area (Header + Content + Footer) -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Header inside main content, starting from left edge (sidebar start) -->
      <%= render 'layouts/header' %>

      <!-- Main Content -->
      <main class="flex-1 p-8 overflow-y-auto">

       <!-- Flash Messages -->
      <% if notice %>
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
          <%= notice %>
        </div>
      <% end %>

      <% if alert %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
          <%= alert %>
        </div>
      <% end %>
        <%= yield %>
      </main>

      <!-- Footer inside main content (same positioning as header) -->
      <%= render 'layouts/footer' %>
    </div>

    <!-- Sidebar Reveal Button (when sidebar is hidden) -->
    <button onclick="showSidebar()" class="sidebar-reveal-btn" aria-label="Show Sidebar">
      <i class="fas fa-bars text-sm"></i>
    </button>

    <!-- Floating Action Button (FAB) -->
    <div id="fab-container" class="fixed bottom-6 right-6 z-50">
      <!-- Main FAB Button -->
      <button id="fab-main-btn"
              class="fab-main w-14 h-14 bg-green-600 hover:bg-green-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-green-300"
              aria-label="Actions Menu"
              onclick="toggleFab()">
        <i id="fab-icon" class="fas fa-plus text-xl transition-transform duration-300"></i>
      </button>

      <!-- FAB Menu Items -->
      <div id="fab-menu" class="fab-menu absolute bottom-16 right-0 flex flex-col items-end space-y-3 opacity-0 pointer-events-none transition-all duration-300 transform translate-y-4">
        <!-- Print Page -->
        <div class="group relative">
          <button onclick="fabPrintPage()"
                  class="fab-menu-item w-12 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110"
                  aria-label="Print Page"
                  title="Print Page">
            <i class="fas fa-print text-base"></i>
          </button>
        </div>

        <!-- Full Screen -->
        <div class="group relative">
          <button onclick="fabToggleFullscreen()"
                  class="fab-menu-item w-12 h-12 bg-purple-600 hover:bg-purple-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110"
                  aria-label="Toggle Fullscreen"
                  title="Toggle Fullscreen">
            <i class="fas fa-expand text-base"></i>
          </button>
        </div>

        <!-- Logout -->
        <div class="group relative">
          <button onclick="fabLogout()"
                  class="fab-menu-item w-12 h-12 bg-red-600 hover:bg-red-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110"
                  aria-label="Logout"
                  title="Logout">
            <i class="fas fa-sign-out-alt text-base"></i>
          </button>
        </div>

        <!-- Scroll Up -->
        <div class="group relative">
          <button onclick="fabScrollToTop()"
                  class="fab-menu-item w-12 h-12 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110"
                  aria-label="Scroll to Top"
                  title="Scroll to Top">
            <i class="fas fa-arrow-up text-base"></i>
          </button>
        </div>

        <!-- Dark Theme Toggle -->
        <div class="group relative">
          <button onclick="fabToggleDarkMode()"
                  class="fab-menu-item w-12 h-12 bg-gray-600 hover:bg-gray-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110"
                  aria-label="Toggle Dark Mode"
                  title="Toggle Dark Mode">
            <i id="dark-mode-icon" class="fas fa-moon text-base"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page-specific scripts -->
  <% if content_for?(:page_scripts) %>
    <%= yield(:page_scripts) %>
  <% end %>
</body>
</html>
